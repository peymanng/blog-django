{% extends 'posts/base.html' %} {% load static %} {% load crispy_forms_tags %}
{% load ratings %} {% block title %} {{ super }} {{post.title}} {% endblock %}
{% block meta %}n
<link
  rel="stylesheet"
  href="{% static 'star-ratings/css/star-ratings.css' %}"
/>
{% endblock meta %} {% block content %}
<div
  class="container d-flex align-items-center justify-content-center flex-column"
>
  <img class="img-fluid rounded w-75" src="{{post.image.url}}" alt="photo" />
  <hr />
  <p class="fw-bold">
    ✍ {{post.author.username}} | 👁 {{post.get_visits}} | 🕒 {{ post.pub_date }}
    | ❤ {{ post.number_of_likes }} | {% ratings post %}
  </p>
  <hr />

  {% if user.is_authenticated %}
  <form action="{% url 'like' post.slug %}" method="post">
    {% csrf_token %} 
    {% if post_is_liked %}
    <button type="submit" class="btn btn-outline-primary">
      &#128078; UnLike
    </button>
    {% else %}
    <button type="submit" class="btn btn-outline-primary">
      &#128077; Like
    </button>
    {% endif %}
  </form>
  {% else %}
  <p class="text-muted">sign up to like this article</p>
  {% endif %}

  <hr />
  <p>{{ post.body }}</p>
  <hr />
  <div class="mt-3 mb-3 text-center">
    <div>
      {% if user.is_authenticated %} {% if new_comment %}
        <h2 class="text-success">Your comment has been added.</h2>
      {% endif %}
      <h2>Add a new comment</h2>
      <form class="d-flex flex-column" action="" method="POST">
        {% csrf_token %} 
        {{ comment_form|crispy }}
        <p>
          <input
            class="btn btn-primary mt-3"
            type="submit"
            value="Add comment"
          />
        </p>
      </form>
      <hr />
      {% else %}
      <h2>Sign in to put comment.</h2>
      {% endif %}
    </div>
        {% for comment in comments %}
        {% if comment.is_parent %}
        <blockquote class="comment my-3 p-3 text-white  bg-gradient bg-primary text-center">
        <p class="text-start">Comment by {{ comment.name }}:</p>
        <q class="fw-bold">
            {{ comment.body|linebreaks }}
        </q>
        <hr>
        {% for replay in comment.replies.all %}
            <div class='replay text-start bg-dark w-100'>
                <h6 class=''>{{replay.name}} replied to {{replay.parent.name}}:</h6>
                ------><q class="fw-bold">{{replay.body}}</q>
            </div>
        {% endfor %}
        </blockquote>
        {% endif %}
        {% empty %}
        <p>There are no comments yet.</p>
        {% endfor %}

  </div>
</div>
{% endblock content %} {% block scripts %}
<script
  type="text/javascript"
  src="{% static 'star-ratings/js/dist/star-ratings.min.js' %}"
></script>
{% endblock scripts %}
